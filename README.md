# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура
В ходе разработки приложения "WEB-ларёк" был использован шаблон проектирования - MVP(Model-View-Presenter), который делит модули на три группы:

* **Model** - отвечает за взаимодействие между сервером и интерфейсом.
* **View** - отвечает за отображение интерфейса.
* **Presenter** - отвечает за управление взаимодействием между моделью данных и отображением.

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.

### Отображение и функционал.
Приложение содержит основной экран с каталогом товаров, а также модальные окна с карточкой товара, корзиной, формами и окном сообщающем об успешном заказе.
Приложение позволяет пользователю выбрать товар (карточку товара), добавить его в корзину, удалить из корзины, оформить заказ путем выбора способа оплаты, ввода адреса доствки и контактных данных. 

Процессы в приложении реализованы через события, описанные в классе EventEmitter в файле events.ts 


## Интерфейсы
1. **IProductItem** - описание типов свойств товара.

```
export interface IProduct { 

  id: string; // id товара 

  title: string; // имя товара 

  price: number | null; // цена товара 

  description: string; // описание товара 

  category: string; // категория товара 

  image: string; // изображение товара 

} 
```


2. **IProductItem[]** - описание типов свойств каталога товаров.
3. **IOrder** - описание типов свойств заказа.

```
export interface IOrder {

  payment: PayMethod; // способ оплаты

  email: string; // email покупателя

  phone: string; // номер телефона покупателя

  address: string; // адрес доставки

  total: number; // итоговая сумма

  items: string[]; // список товаров в заказе

}
```

4. **IOrderResult** - описание типов свойств итогового заказа.

```
export interface IOrderResult {

  id: number; // id товара

  total: number; // итоговая сумма

}
```

5. **IAppState** - описание типов свойств каталога, корзины, товара.

```
export interface IAppState {

  catalog: IProductItem[]; // список продуктов в каталоге

  basket: string[]; // список продуктов в корзине

  order: IOrder | null; // данные заказа

}
```

6. **IEvents** - описание типов методов событий подписки, отписки и уведомления подписчиков.

```
export interface IEvents {

    on<T extends object>(event: EventName, callback: (data: T) => void): void; // подписка на событие

    emit<T extends object>(event: string, data?: T): void; // генерация события

    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void; // вызов обработчика событий

}
```

* **IContacts** - описание типов контактных данных.

```
export interface IContacts {

  email: string; // email покупателя

  phone: string; // номер телефона покупателя

}
```

* **IFormState** - описание типов результатов валидации.

```
export interface IFormState {

  valid: boolean; // состояние валидации

  errors: string[]; // список ошибок валидации

}
```

* **IModalData** - описание типов HTML контента.

```
export interface IModalData {

  content: HTMLElement; // HTML элементы

}
```

* **ISuccess** - описание типов успешного заказа.

```
export interface ISuccess {

  total: number; // Итоговая сумма заказа

}
```

* **IBasketView** - описание типов HTML элемента карточки товара в корзине и количества товаров в корзине.

```
export interface IBasketView {

  items: HTMLElement; // элемент карточки в корзине

  total: number; // кол-во товаров в корзине

}
```

* **ICardBasket** - описание типов названия и стоимости товара в корзине.

```
export interface ICardBasket {

  title: string; // название товара

  price: number; // стоимость товара

}
```


## Описание данных
### Model
1. **class Model** - абстрактный базовый класс для создания объекта хранения данных приложения. Получает тип в виде дженерика Model<T>.

  Конструктор:

  ```
  constructor(data:Partial<T>, events: IEvenets) - принимает начальные данные для модели и объект событий для уведомления о изменениях в модели.
  ```
  
  Методы:
  * emitChanges - сообщает подписчикам о том, что модель поменялась.
   
2. **class AppState** - содержит методы управляющие состояниями приложения. Расширяется классом Model с типом в виде дженерика <IAppState>.
  
  Методы:
  * throwInBasket - добавляет переданный элемент в корзину и затем сообщает об изменении в корзине.
  * removeInBasket - удаляет товар из корзины.
  * clearOrder - очищает поля заказа.
  * clearBasket - очищает корзину с заказом. 
  * getTotal - возвращает общую сумму заказа в корзине.
  * setCatalog - передает в модель данных массив товаров, запускает событие изменения каталога товаров в модели данных.
  * setPreview - устанавливает идентификатор элемента item в свойство preview класса и затем сообщает о изменении превью
  * checkContentBasket - возвращает содержимое корзины.
  * checkBasket - проверяет находится ли item - товар в корзине.
  * setOrder - передает данные из корзины в заказ.
  * setOrderField - устанавливает значение в свойство order класса, валидирует поле контактов.
  * setPayment - передает данные о способе оплаты в заказ, валидирует поле доставки. 
  * setAddress - передает данные адреса в заказ, валидирует поле доставки. 
  * setEmail - передает email в заказ, валидирует поле контактов.
  * setPhone - передает номер телефона в заказ, валидирует поле контактов. 
  * validateOrderPay - валидация модального окна со способом оплаты и адресом.
  * validateOrderContacts - валидация формы контактов.

### View
1. **class Component** - абстрактный базовый класс для работы с элементами DOM. Получает тип в виде дженерика Component<T>.

  Конструктор:

  ```
  protected constructor(protected readonly container: HTMLElement) - принимает экземпляр HTML элемента, доступный только для чтения.
  ```
  
  Методы:
  * toggleClass - переключает класс в DOM.
  * setText - устанавливает текст в textContent.
  * setDisabled - устанавливает и снимает статус блокровки disabled.
  * setHidden - меняет свойство display на none.
  * setVisible - удаляет свойство display, показывая контент.
  * setImage - устанавливает изображение с алтернативным текстом.
  * render - возвращает корневой DOM-элемент.
   
2. **class Basket** - функционал для отображения элементов корзины и её состояния. Расширяется классом Component с дженериком <IBasketView>.

  Конструктор:

  ```
  constructor(container: HTMLElement, protected events: EventEmitter) - принимает два аргумента: container типа HTMLElement и events типа EventEmitter. Конструктор создает элементы внутри контейнера, возвращает элемент по селектору, если он существует, или создает его, если не существует. Добавляется обработчик события click к элементу _button, который вызывает метод emit объекта events с событием 'order:open'.
  ```
  
  Методы:
  * set items - устанавливает список элементов items в определенное состояние. Если items.length больше нуля, метод заменяет содержимое элемента _list новыми элементами и снимает блокировку с кнопки _button. Если items.length равно нулю, метод заменяет содержимое элемента _list на параграф с текстом "Корзина пуста" и блокирует кнопку _button.
  * set total - устанавливает текст к итоговой сумме заказа "n синапсов".
   
3. **class Form** - функионал управления закрытием и открытием формы и её валидацией. Получает тип в виде дженерика <T> и расширяется классом Component с дженериком <IFormState>.

  Конструктор:

  ```
  constructor(protected container: HTMLFormElement, protected events: IEvents) - принимает два аргумента: container типа HTMLFormElement и events типа IEvents. В конструкторе устанавливаются обработчики событий для элементов формы, а также инициализируются элементы управления. 
  ```

  Методы:
  * onInputChange - вызывает событие с помощью this.events.emit, передавая в него строку, которая представляет собой имя поля ввода и field, а также значение value.
  * set valid - меняет кнопку отправки формы.
  * set errors - устанавливает текст при ошибке.
  * render - рендерит форму, используя состояние state.
   
4. **class Modal** - функционал для отображения и закрытия модальных окон. Расширяется классом Component с дженериком <IModalData>.

  Конструктор:

  ```
  constructor(container: HTMLElement, protected events: IEvents) - принимает два аргумента: container типа HTMLElement и events типа IEvents. В конструкторе инициализируются элементы управления модального окна, устанавливаются обработчики событий для закрытия модального окна и предотвращения его закрытия при клике на содержимом.
  ```
  
  Методы:
  * set content - устанавливает содержимое модального окна в классе.
  * _toggleModal - переключение модального окна
  * _handleEscape - закрытие модального окна по esc
  * open - открывает модальное окно.
  * close - закрывает модальное окно.
  * render - рендерит модальное окно с данными data.
   
5. **class Order** - функционал для формы оформления заказа: способ оплаты и адресс доставки. Расширяется классом Form с дженериком <IOrder>.

  Конструктор:

  ```
  constructor(container: HTMLFormElement, events: IEvents) - принимает два аргумента: container типа HTMLFormElement и events типа IEvents. В конструкторе инициализируется массив кнопок с классом button_alt, найденных в контейнере, и для каждой кнопки устанавливается обработчик события click, который вызывает метод setClass класса с именем кнопки и эмиттит событие payment:changed с данными о целевой кнопке.
  ```
  
  Методы:
  * setClass - устанавливает класс для кнопки с определенным именем.
  * set address - устанавливает адрес в поле ввода с именем 'address'.
   
6. **class Success** - функционал отображения окна, сообщающего об успешном заказе. Расширяется классом Component с дженериком <ISuccess>.

  Конструктор:

  ```
  constructor(container: HTMLElement, synapses: number, actions: ISuccessActions) - принимает три аргумента: container типа HTMLElement, synapses типа number и actions типа ISuccessActions. В конструкторе инициализируются элементы _total и _close, устанавливается текст для _total и добавляется обработчик события для _close.
  ```

7. **class Page** - функционал отображения главной страницы. Расширяется классом Component с дженериком <IPage>.

  Конструктор:

  ```
  constructor(container: HTMLElement, protected events: IEvents) - принимает два аргумента: container типа HTMLElement и events типа IEvents. В конструкторе инициализируются элементы _counter, _catalog, _wrapper и _basket к которому добавляется обработчик события.
  ```
  
  Методы:
  * set counter - устанавливает значение счетчика в классе.
  * set catalog - устанавливает каталог в классе.
  * set locked - устанавливает состояние блокировки в классе.
   
8. **class Card** - функционал для отображения данных карточки товара. Расширяется классом Component с дженериком <ICard>.

  Конструктор:

  ```
  constructor(blockName: string, container: HTMLElement, events: ICardActions) - принимает три аргумента: blockName типа string, container типа HTMLElement и events типа ICardActions. В конструкторе инициализируются элементы _title, _description, _image, _price, _category и _button внутри контейнера, а также добавляется обработчик события к _button.
  ```
  
  Методы:
  * set title - устанавливает заголовок для объекта класса. 
  * set description - устанавливает описание для объекта класса.
  * set image - устанавливает изображение для объекта класса.
  * set price - устанавливает цену для объекта класса.
  * get price - возвращает цену объекта класса как число.
  * set category - устанавливает категорию для объекта класса.
  * set button - устанавливает текст для кнопки объекта класса.
   
9. **class CardBasket** - отвечает за отображение информации о карте в корзине. Расширяется классом Component с дженериком <ICardBasket>.

  Конструктор:

  ```
  constructor(idx: number, container: HTMLElement, events: ICardActions) - принимает три аргумента: idx типа number, container типа HTMLElement и events типа ICardActions. В конструкторе инициализируются элементы _index, _title, _price и _button внутри контейнера, добавляется обработчик события к _button.
  ```
 
  Методы:
  * set title - устанавливает текст в элементе _title.
  * set index - устанавливает текст в элементе _index.
  * set price - устанавливает текст в элементе _price.
   
10. **class Contacts** - функционал для отображения формы с контактными данными: email и телефон. Расширяется классом Form с дженериком <IContacts>.

  Конструктор:

  ```
  constructor(container: HTMLFormElement, events: IEvents) - принимает два аргумента: container типа HTMLFormElement и events типа IEvents. Внутри вызывается конструктор родительского класса с переданными аргументами.
  ```
  
  Методы:
  * set phone - устанавливает форму ввода номера телефона.
  * set email - устанавливает форму ввода email.

### Presenter
1. **class EventEmitter** - базовый класс, отвечающий за обработку событий. Имплементируется интерфйесом IEvents.

  Конструктор:

  ```
  constructor() - не принимает аргументов, инициализирует объект _events.
  ```
  
  Методы:
  * on - устанавливает обработчик на событие.
  * off - снимает обработчик с события.
  * emit - инициирует событие с данными.
  * onAll - слушает все события.
  * offAll - сбрасывает все обработчики.
  * trigger - создает коллбек триггер, генерирующий событие при вызове.
  
### API
2. **class Api** - базовый класс, отвечающий за работу с сервером посредством запросов на получение (GET) и отправку (POST) данных.

  Конструктор:

  ```
  constructor(baseUrl: string, options: RequestInit = {}) - принимает два аргумента: baseUrl типа string, который является базовым URL для запросов, и options типа RequestInit, который является объектом с опциями для запросов. 
  ```
 
  Методы:
  * handleResponse - обрабатывает ответ от сервера. В зависимости от ответа возвращает данные или ошибку.
  * get - выполняет GET-запрос к серверу по uri.
  * post - выполняет POST-запрос к серверу по uri.
   
3. **class WebLarekApi** - потомок класса Api. Обеспечивает обмен данных между сервером и моделью данных приложения. Расширяется классом Api, имплементируется интерфейсом IWebLarekAPI.

  Конструктор:

  ```
  constructor(cdn: string, baseUrl: string, options?: RequestInit) - принимает три аргумента: cdn типа string, который является URL CDN, baseUrl типа string, который является базовым URL для запросов, и options типа RequestInit, который является объектом с опциями для запросов.
  ```
 
  Методы:
  * getProductItem - делает запрос к серверу для получения информации о продукте по его ID.
  * getProductList - делает запрос к серверу для получения списка продуктов.
  * orderProducts - делает POST-запрос к серверу для оформления заказа.



